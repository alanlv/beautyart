<table id="dg" title="文章列表" style="width:550px;height:250px">
</table>

<div id="toolbar">
    <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="updateuser()">编辑文章</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="destroyUser()">删除文章</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="adduser()">增加文章</a>


    <label>目录：</label>
    <select name='cid' id='cid' class="form-control" style='width:120px;margin: 0'>
        <option value=""></option>
    {{range $index, $e :=.category}}
        <option value={{$e.Id}}>{{$e.Title}}</option>
    {{range $index1, $e1 :=$e.Son}}
        <option value={{$e1.Id}}>-------{{$e1.Title}}</option>
    {{end}}
    {{end}}
    </select>
        <label>状态：</label>
        <select id='status' class="form-control" name='status' style='width:120px;margin: 0 5px'>
            <option value=1>已开启</option>
            <option value=0>已关闭</option>
        </select>
        <a href="#" class="easyui-linkbutton" onclick="getabout()">查询</a>

</div>

<script type="text/javascript">
    $('#dg').datagrid({
        url: '/blog/paper/index',
        collapsible: true,
        toolbar: '#toolbar',
        rownumbers: true,
        pagination: true,
        pageList: [5, 10, 30],
        fit: true,
        columns: [[
            {field: 'ck', checkbox: true},
            {field: 'Id', title: '单页ID', width: 100, hidden: true},
            {
                field: 'Title', title: '标题', width: 120,
                formatter: function (value, row, index) {
                    return "<a target='_blank' href='__ROOT__/Ei/User/article?username=" + row.username + "&id=" + row.id + "'>" + value + "</a>";
                }
            },
            {field: 'Username', title: '作者', width: 120},
            {field: 'Cid', title: '目录', width: 120},
            {field: 'Createtime', title: '创建时间', width: 120},
            {field: 'Updatetime', title: '更新时间', width: 120},
            {field: 'View', title: '浏览量', width: 100},
            {field: 'Sort', title: '排序', width: 100},
            {
                field: 'Status', title: '状态', width: 120,
                formatter: function (value, row, index) {
                    //alert(value);
                    $para = row.id + ',';
                    if (value == 1) {
                        return "已开启|<button style='color:red;font-size:1.1em;margin-left:10px;cursor:pointer' onclick='updatestatus(" + $para + "0)'>关闭</a>";
                    } else {
                        return "已关闭|<button style='color:red;font-size:1.1em;margin-left:10px;cursor:pointer' onclick='updatestatus(" + $para + "1)'>开启</a>";
                    }
                    //alert(row);
                    //一整行数据
                    //alert(index);第几行
                }
                //
            }
        ]]
    });


    function destroyUser() {
        var rows = $('#dg').datagrid('getSelections');
        if (rows.length != 0) {
            $.messager.confirm('Confirm', '你确定要删除?', function (r) {
                if (r) {
                    var uri = "blog/paper/deletepaper";
                    for (var i = 0; i < rows.length; i++) {
                        var row = rows[i];
                        $.post(uri, {'id': row.id}, function (result) {
                            $.messager.show({	// show error message
                                title: '消息',
                                msg: result.info
                            });
                            $('#dg').datagrid('reload');	// reload the user da
                        });
                    }
                }
            });
        } else {
            alert("请勾选按钮")
        }
    }


    function updateuser() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            window.open("blog/paper/updatepaper?id=" + row.id);
        } else {
            alert("请勾选按钮")
        }
    }

    function adduser() {
        window.open("blog/paper/addpaper");
    }


    function getabout() {
        var status = $('#status').val();
        var cid = $('#cid').val();
        $('#dg').datagrid('load', {
            status: status,
            cid: cid
        });
    }

    function updatestatus(id, status) {
        $.post('blog/paper/updatepaper', {'updatestatus': 1, 'id': id, 'status': status}, function (result) {
            $.messager.show({	// show error message
                title: '消息',
                msg: result.info
            });
            $('#dg').datagrid('reload');	// reload the user da
        });

    }
</script>